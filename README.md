# Parsering_apache_logs

## Описание
Parsering_apache_logs - это приложение для чтения и анализа логов сервера Apache и предоставления данных через API.

## Установка
Для установки необходимо выполнить следующие шаги:
    ```
    pip install flask
    pip install schedule
    pip install psycopg2
    ```

## Запуск

Для заполнения базы данных:
main.py
Тут присутствует две команды: 
export - заполнение базы данных
select - вывод в консоль из быза данных


Для запуска API :
api.py


## Использование:

### API

API поддерживает следующие параметры запроса:

- **ip**: IP-адрес для фильтрации логов.
- **start_date**: Начальная дата временного промежутка (в формате ГГГГ-ММ-ДД).
- **end_date**: Конечная дата временного промежутка (в формате ГГГГ-ММ-ДД).

#### Получение логов
- **Метод**: GET
- **Путь**: `/logs`
- **Примеры запросов**:
  - http://127.0.0.1:5000/logs
  - http://127.0.0.1:5000/logs?ip=192.168.1.1
  - http://127.0.0.1:5000/logs?start_date=2024-06-01&end_date=2024-06-13

### Консольное приложение

В консольном приложении есть 2 команды:

- **select_logs**: принимает от 0 до 2 дат в формате ГГГГ-ММ-ДД и необходимые столбцы. Все даты и столбцы являются необязательными параметрами и могут идти в любом порядке.
- **init_export**: команда собирает все логи согласно паттернам из ваших файлов и отправляет их в базу данных.

#### Примеры работы выборки из базы данных через консоль

- select_logs
- select_logs date_time weight
- select_logs date_time weight
- select_logs 2006-01-01
- select_logs 2006-01-01 2010-01-01
- select_logs date_time 2006-01-01 weight 2010-01-01
- select_logs date_time 2006-01-01

## Автоматизация

`sending_data.py` автоматически собирает логи согласно установленному промежутку, его можно изменить на 18 строке - `schedule.every(5).seconds.do(main)`.

## Возможные модификаторы

- **%h**: IP-адрес клиента (например, 192.168.2.20 и 127.0.0.1).
- **%t**: Время запроса в формате [день/месяц/год:час:минута:секунда часовой_пояс].
- **%r**: Первая строка запроса.
- **%>s**: Статус ответа сервера.
- **%b**: Размер ответа в байтах.

## Конфигурация

Отредактируйте файл `config.py`, чтобы указать параметры подключения к вашей базе данных и пути к файлам логов с их паттернами.

## Дополнительная информация

- Приложение использует PostgreSQL для хранения логов. Убедитесь, что у вас есть база данных с правильными параметрами подключения.
- При необходимости настройте параметры подключения к базе данных в файле `config.py`.
